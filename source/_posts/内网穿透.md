---
title: 内网穿透配置笔记
date: 2026-1-17 00:00:00
tags:
  - 工具
categories:
  - 实践
cover: images/delivery.jpeg
excerpt: 记录利用 frp 实现内网穿透的过程
---

## 前言
下个月就要回家过年了。为了在家也能 SSH 访问实验室服务器，我决定尝试用 frp 做内网穿透。

frp（fast reverse proxy）是一个专注内网穿透的开源应用，包含客户端和服务端。内网穿透需要一台拥有公网 IP 的服务器运行 frp 服务端来作为中转站，并在一台内网设备上运行 frp 客户端；此时公网中的设备就可以通过访问中转站来与内网通信。在热心同门的指导下，我通过学生认证申请了一台阿里云的ECS云服务器作为中转服务器。

## 服务端
### 下载 frp
首先获取最新版本的 frp：
```bash
wget https://github.com/fatedier/frp/releases/download/v0.66.0/frp_0.66.0_linux_amd64.tar.gz
tar -zxvf frp_0.66.0_linux_amd64.tar.gz
mv frp_0.66.0_linux_amd64 frp
```
下载并解压完成后，可以看到 `frpc`、`frpc.toml`、`frps`、`frps.toml`，分别是 frp 的客户端、客户端配置、服务端、服务端配置。从 v0.52.0 版本起，frp 支持 `.toml`、`.yaml` 和 `.json` 格式的配置文件，而旧版常见的 `.ini` 文件将被逐渐弃用。

### 配置 frps
以 `.toml` 为例，我们编辑服务端配置文件 `frps.toml`：
```toml
# frps 监听 IP 和端口
bindAddr = "0.0.0.0"
bindPort = 25252

# 身份认证令牌（可选）
auth.token = "******"

# WEB管理面板设置
webServer.addr = "0.0.0.0"
webServer.port = 7500
webServer.user = "admin"
webServer.password = "*****"
```

完成配置以后，还需要注意在防火墙上开放端口，并在阿里云的控制台上设置安全组规则。

最后直接后台运行 frps 即可：
```bash
nohup ./frps -c frps.toml &
```

### 以系统服务方式运行 frps
为了长期使用方便，还可以将 frps 添加为系统级别 systemd 服务，实现开机自启。创建 `/etc/systemd/system/frps.service`：
```ini
[Unit]
Description=FRP Server Service
After=network.target

[Service]
Type=simple
ExecStart=/root/frp/frps -c /root/frp/frps.toml
Restart=on-failure
RestartSec=5s

[Install]
WantedBy=multi-user.target
```
然后重载配置，设置自启动并激活服务：
```bash
sudo systemctl daemon-reload
sudo systemctl enable frps
sudo systemctl start frps
sudo systemctl status frps
```
如果之后修改了相关配置，需要重启服务：
```bash
sudo systemctl restart frps
```

## 客户端
### 下载 frp
同样地，先获取最新版本的 frp：
```bash
wget https://github.com/fatedier/frp/releases/download/v0.66.0/frp_0.66.0_linux_arm64.tar.gz
tar -zxvf frp_0.66.0_linux_arm64.tar.gz
mv frp_0.66.0_linux_arm64 frp
```

### 配置 frpc
同样地，编辑 `frpc.toml`：
```toml
serverAddr = "***.***.**.***" # 中转服务器公网 IP
serverPort = ***** # 中转服务器的 frps 端口
auth.token = "**********" # 认证令牌

[[proxies]]
name = "ssh-dgx"
type = "tcp"
localIP = "127.0.0.1" # 代理本机的 SSH
localPort = 25252 # 本地 SSH 端口
remotePort = 10517 # 映射到中转服务器的端口
transport.useEncryption = true # 加密传输
transport.useCompression = true # 数据压缩

[[proxies]]
name = "ssh-223"
type = "tcp"
localIP = "10.82.1.223" # 还可以代理内网中其他机器
localPort = 8864 # 该机器 SSH 端口
remotePort = 10223
transport.useEncryption = true
transport.useCompression = true
```

配置完成后，同样后台运行即可：
```bash
nohup ./frpc -c ./frpc.toml &
```

### 以系统服务方式运行 frpc
同样地，我们可以将 frpc 添加为系统级别 systemd 服务。
> 如果只添加为用户级别服务，服务有可能会在用户所有会话都退出时被终止。幸运的是，我在内网中恰巧有一台拥有sudo权限的机器。

创建 `/etc/systemd/system/frpc.service`：
```ini
[Unit]
Description=FRP Client Service
After=network.target

[Service]
Type=simple
ExecStart=/home/omniai-1/frp/frpc -c /home/omniai-1/frp/frpc.toml
Restart=on-failure
RestartSec=5s

[Install]
WantedBy=multi-user.target
```
与 frps 同样的操作：
```bash
sudo systemctl daemon-reload
sudo systemctl enable frpc
sudo systemctl start frpc
sudo systemctl status frpc
```
至此，就可以通过访问中转服务器来访问内网的各个设备了！
